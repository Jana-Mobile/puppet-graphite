#!/bin/bash

# Because graphite has now way to configure the logrotation,
# we do that with a cronjob and this script.
 
CARBON_LOGS_PATH="<%= scope.lookupvar('graphite::carbon_log_dir_REAL') %>/"

ROTATE_DAYS=3
RETENTION=30

# gzip log files older than $ROTATE_DAYS days
find "${CARBON_LOGS_PATH}" -type f -mtime +${ROTATE_DAYS} ! -name "*.gz" -exec gzip -q "{}" \;
# removes log files older than $RETENTION days
find "${CARBON_LOGS_PATH}" -type f -ctime +${RETENTION} -delete
